example = r""".|...\....
|.-.\.....
.....|-...
........|.
..........
.........\
..../.\\..
.-.-/..|..
.|....-|.\
..//.|...."""

my_input = r"""\...........-..../..........|..\..-....-......-...../........|......................./............-.\......|..
......-.........../............-......../...............................|...../.........-...........\.........
\...............-............\.............................................-......-...|....\..................
.........|...-.....-............../.....\.................................\.................|/..........-.....
......./....-..........\-...\.........../...........................-........./...........-..................|
....................\.....|.../.......\-...........\......../........|..../................-..........|\-.....
......./....|.../..........-...|../...|..../-..../...............\..|......./...............-.................
............-.........../..|.......................\..\.........\........|........\............\.......-......
...../.......|-..-||............\......................|.../...........-................-.....|..../../.......
....\........|.................|...-.................\.......||............|../....../\.......-...|...........
......\.....................................|.........-....-..|.|.../-../..........\..................../.....
..|.........................................\........./.....\......./...||........|.................|.\....|..
/|...../......../...\../.........\......-..........................\..-.......\......................|..-.....
............../.............\...................\..............|......./...........|..................\.......
./..-.-.../......\............................/.................\..........-../........\......................
.....|............................./....\.........\......\............-.--.............|..........|...|.......
............-................................................\..\..............|.....................\.-..\/..
..\.................../........................|...|........|....\...\......../..........|...............-....
.............../........................./\...............-...................../.........................-./.
...........................//...............|.............\-..................|...\..........|..-........\....
.../.........//.../.....././.....|........-....-..\.......-.|..............|............-...........-..\..\...
/.......................-...............|....../.../|-.............-../..../................|.........|..../-.
|............\..-\\.\..../-.....||...\......-......||.........|....\....-.........-..............-............
.........\....../.|......-....................................\./........./...........................\.\.....
...............\................................................./-..............|/.................-.........
......\.\.......\...|........./.................../..|.....|...-................./.-/.-.....\................-
.......\.................../.\........../.../......./......\.......-..../...\.......|........|..\...\....|..-.
..\.........\....................................-....../../../..\.........|.....\..........\................-
..........--........\....-...\/......../.../......|.\./..............................................-/.....\.
...................\.....-...\|......\.......\....|.............|...........|.................-...........|...
.../.........|.........-.....................|....-.................-....|..............................|.../|
............|................/....\.................................................\./..|.........../...../..
..|................/....................|/........-......................|........./\................\........
.-......|......./..|../..............................|..........|........\...............................-....
...../............|................|.../..-........-......\..........\..../..................../.-............
..../............|.........../.....-....\.............-....\..................|.........................-.....
....|.........-\..........|............-...............\.............--.-....................-........-..-....
...............-.-.........|............../...../|........\..\...........-...\.|..............................
......-../.........\...........................|................/........|........|/.........../....-.........
................./......\......................\\....|............/.-\....|....................|......|.......
|...............|.|-........\\................/.....................-.........-..-..../..--...................
.........\.....\....\..\....-.......|........|...............................|......../............\\...\.....
....|../...................|../.........../.............|........-............................../........../..
...\..................-..|...................|\.....|.........\....\./.\.../.........-....|...................
......\.\..........-....\.\/../........./..............|......\........./........\...../...../................
......../............-..../.-...\.|.|-...........|...-..-................................/....................
.........../..\...-.......|......./.......-.............-............-.............../\...............|\......
..|.......-......................\.\../.........|-/........|\-.../...-.-..-...............|-/........-././/...
......|...|............|................\|.........-.........../..../.....-.........../........\.......\......
.|\..|.......\.\..................\|........./......\/.|................./............\........|\......./....-
........\||....\/...-.........\...|....-..-.-.........................../.....|..........\..|.....\........./.
...............................-......|..............-.............\.........\.|........./....................
........-.........................-.................-.......-.\.........../..../.\.............|.....|/...--..
......|.............\-|..................-........./....../...............\....\....-................-........
..-........-../.\|...........\...................--.....-.....................................................
.../../.............../....|........./.\.....-...........\..../..........|.......-.......................\../.
...............\............-........../.-.............-.............|...........|................|./....|....
............-.....-...................-...................|.../.\.-......-.....-.\............/.............-\
.../.........../........................................\.......................................--............
..|.\..|.|\...-..\.............|.....\...........................|\...........\.........-......\....-...\.\...
....../......................|.......|.........-......\.....|..../.............................\...../-.......
..-..................\...\................/............./...............-....-./........./......|..........\|.
..|.....|..........|................\.\./.........../.............\./....\........--.-..-.../...\./-..........
........-.....-........\............-|..........................\...\../..-.....\...|.........................
..........|...-.............\..............|......./......../............./.-........................./..\....
............|........../..................-................-.......|...../...|/.......-.......................
.............\........|............../..-...-.-...\\..../..\.....-............./....-..../\......./.......-...
................-.....|.......................................|....................\................/.........
.....\......../..\-......\...-.....-............................-......./........\.-............/.............
.............................................-.................................../\.....|.....................
|................|.....|.||...\................/...\........-........../.............\....-./........-........
../.....................\..............-.............-................|................-/.....|......./.......
........|../........|......\......................../..\..|............|.....\......\.........../..|.\.../....
|/..../......-.............../....\../......................|..............|..........|................/.-...-
..../.......\.............../.\...........\.....-..........................|............\.....|...............
.....................................\....-..................\-.....................\.|....|...........\......
../.\..........|.....-......../......../|..........|................./.\................................../.-.
.............\....|.|........-....|......................\.....\....../..........--.......-./.\........./.....
........................................-..-\..|.........-\.\\.......\.................................\-..../
......../......-.....-....-........-..\..\.-....\....././............/..../.......|........../.--......../....
...-...-................/...................../../.-...............\./......-...|.|................./.........
.......|/............\\............/....\.....|.........\......-....../............./.....\.........-.........
..-................................/....................\......|............./...-........|.....-...../.......
.-...|......./....-............\..........-......\............-.....................|......|............\...\.
./............-.......................-.../...................|......../........\.-...........................
...............\................./.|......../.........|...........................|..................\........
.......................|.......|..../.....|......|.....-...........|.................|...............|........
...\../....../...|...........-...........-.....\..................-..............|..............\../....../...
.........|\/..-\....../.......................|...|../.........-...../.-..-...-........./...................-.
|........./-..|............./.....|........|.....\................-..|..-........................../......-...
.........................................-................\..................\............................-../
....|...........|../../........................\.........\.....-....................-....-...\./..............
....|.........|/..../|..............................-/...........-.........||.........|....-...............\..
........|-.......|............-\\........|............-.\............\...|..|................|................
............\.......-............../..........|.....................-.........-................./|............
.\................\..|.|......................\........\...........\................-..........-....../.....\.
\.........................|......|............|........-....\...../........|.............\....\............-..
./................\.../...................|..................-......//............./......\...................
.........\......../....\..................../-........................-...........|...-.......................
...........\....../......|...........................................\./.........\...|.......\.......|....-...
............/.......................|.....|...........|...........|......./|.........................\........
...............-........................../..................|...........................|/..\..........-.\.\.
......|../................-.../.............|..........|............../.\........--....|................././..
..../......|.../.............-...../........\.........\..../...-...........\...\....-......../..-...-.../|.|..
.........|.................|......................-................|...-..................................\...
............................./...............||./.\../...................\.............../................./..
./...................-.....................-............-.-//......-\............../..............\.\...|....-
...................-...............|...../.......-../......\..-.........|....../\....\.....\..................
|............/....\....-.......-......................-........................|...................../........
......../.-....\..........\............................-....-......................\..\.................-...\\"""

def treat_beam(grid, beam):
  x,y,dx,dy = beam
  path = []
  while x >= 0 and x < len(grid[0]) and y >= 0 and y < len(grid):
    path.append((x,y))
    if grid[y][x] == "|" and dx != 0:
      return path, [(x,y,0,1), (x,y,0,-1)]
    elif grid[y][x] == "-" and dy != 0:
      return path, [(x,y,1,0), (x,y,-1,0)]
    elif grid[y][x] == "/":
      if dx == 1:
        dx = 0
        dy = -1
      elif dx == -1:
        dx = 0
        dy = 1
      elif dy == 1:
        dx = -1
        dy = 0
      elif dy == -1:
        dx = 1
        dy = 0
    elif grid[y][x] == ")": # \ case
      if dx == 1:
        dx = 0
        dy = 1
      elif dx == -1:
        dx = 0
        dy = -1
      elif dy == 1:
        dx = 1
        dy = 0
      elif dy == -1:
        dx = -1
        dy = 0
    x += dx
    y += dy
  return path, []

def part1(input, start=(0,0,1,0)):
  grid = [list(x) for x in input.replace("\\", ")").splitlines()]
  beams=[start]
  treated_beams = []
  energized = set()
  while beams:
    beam = beams.pop()
    if not beam in treated_beams:
      treated_beams.append(beam)
      path, new_beams = treat_beam(grid, beam)
      beams.extend(new_beams)
      energized.update(path)
  return len(energized)


def part2(input):
  max_y = len(input.splitlines())
  max_x = len(input.splitlines()[0])
  all_starts = [(x, 0, 0, 1) for x in range(max_x)] \
    + [(x, max_y-1, 0, -1) for x in range(max_x)] \
    + [(0, y, 1, 0) for y in range(max_y)] \
    + [(max_x-1, y, -1, 0) for y in range(max_y)] 

  return max(part1(input, start) for start in all_starts)
  

print("Part1 example : " + str(part1(example)))
print("Part1 my_input : " + str(part1(my_input)))

print("Part2 example : " + str(part2(example)))
print("Part2 my_input : " + str(part2(my_input)))
